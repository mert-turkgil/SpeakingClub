@model SpeakingClub.Models.CarouselEditModel

@{
    ViewData["Title"] = "Edit Carousel";
}

@section Css {
    <style>
        .current-image-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #dee2e6;
        }
        .current-image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .preview-container {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            border: 2px dashed #0d6efd;
        }
        .preview-container img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .image-info {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 8px;
        }
        .form-section {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .form-section h4 {
            color: #0d6efd;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0d6efd;
        }
        .link-preview {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .badge-new {
            background: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
        }
    </style>
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-xl-10">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-warning text-dark py-3">
                    <h2 class="mb-0 fw-bold">
                        <i class="fas fa-edit"></i> Edit Carousel Slide
                    </h2>
                </div>
                <div class="card-body p-4">
                    <form asp-action="CarouselEdit" asp-controller="Admin" asp-route-id="@Model.CarouselId" 
                          method="post" enctype="multipart/form-data" id="carouselForm">
                        <input type="hidden" asp-for="CarouselId" />
                        <input type="hidden" asp-for="DateAdded" />

                        <!-- General Information -->
                        <div class="form-section">
                            <h4><i class="fas fa-info-circle"></i> General Information</h4>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="CarouselTitle" class="form-label fw-semibold">
                                        Title (English) <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="CarouselTitle" class="form-control" required />
                                    <span asp-validation-for="CarouselTitle" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="CarouselLinkText" class="form-label fw-semibold">
                                        Button Text (English)
                                    </label>
                                    <input asp-for="CarouselLinkText" class="form-control" />
                                    <span asp-validation-for="CarouselLinkText" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label asp-for="CarouselDescription" class="form-label fw-semibold">
                                    Description (English) <span class="text-danger">*</span>
                                </label>
                                <textarea asp-for="CarouselDescription" class="form-control" rows="3" required></textarea>
                                <span asp-validation-for="CarouselDescription" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="CarouselLink" class="form-label fw-semibold">
                                    Link / Action
                                </label>
                                <input asp-for="CarouselLink" class="form-control" placeholder="e.g., Blog, Contact, About, Index" />
                                <span asp-validation-for="CarouselLink" class="text-danger"></span>
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> Enter an action name or leave empty
                                </small>
                                <div class="link-preview mt-2" id="linkPreview" style="display:@(string.IsNullOrEmpty(Model.CarouselLink) ? "none" : "block");">
                                    <strong>Link will navigate to:</strong> <span id="linkPreviewText">Home/@Model.CarouselLink</span>
                                </div>
                            </div>
                        </div>

                        <!-- Image Upload -->
                        <div class="form-section">
                            <h4><i class="fas fa-images"></i> Images</h4>
                            <p class="text-muted">
                                <i class="fas fa-lightbulb"></i> Upload new images to replace existing ones. Leave empty to keep current images.
                            </p>

                            <!-- Primary Image -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">Primary Image</label>
                                @if (!string.IsNullOrEmpty(Model.CarouselImagePath))
                                {
                                    <div class="current-image-container">
                                        <strong class="d-block mb-2">Current Image:</strong>
                                        <img src="~/img/@Model.CarouselImagePath" alt="Current Primary Image" />
                                        <div class="image-info mt-2">
                                            <i class="fas fa-check-circle text-success"></i> Currently using: @Model.CarouselImagePath
                                        </div>
                                    </div>
                                }
                                <label class="form-label">Upload New Primary Image (Optional)</label>
                                <input asp-for="CarouselImage" type="file" class="form-control" accept="image/*" id="primaryImage" />
                                <span asp-validation-for="CarouselImage" class="text-danger"></span>
                                <small class="text-muted">Only upload if you want to replace the current image</small>
                                <div id="primaryPreview" class="preview-container" style="display:none;">
                                    <span class="badge-new">NEW</span>
                                    <img id="primaryImg" src="" alt="New Preview" />
                                    <div class="image-info" id="primaryInfo"></div>
                                </div>
                            </div>

                            <!-- 600w Image -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">600w Image (Mobile)</label>
                                @if (!string.IsNullOrEmpty(Model.CarouselImage600wPath))
                                {
                                    <div class="current-image-container">
                                        <strong class="d-block mb-2">Current 600w Image:</strong>
                                        <img src="~/img/@Model.CarouselImage600wPath" alt="Current 600w Image" />
                                        <div class="image-info mt-2">
                                            <i class="fas fa-check-circle text-success"></i> Currently using: @Model.CarouselImage600wPath
                                        </div>
                                    </div>
                                }
                                <label class="form-label">Upload New 600w Image (Optional)</label>
                                <input asp-for="CarouselImage600w" type="file" class="form-control" accept="image/*" id="image600w" />
                                <span asp-validation-for="CarouselImage600w" class="text-danger"></span>
                                <small class="text-muted">Recommended for mobile devices</small>
                                <div id="preview600w" class="preview-container" style="display:none;">
                                    <span class="badge-new">NEW</span>
                                    <img id="img600w" src="" alt="New Preview 600w" />
                                    <div class="image-info" id="info600w"></div>
                                </div>
                            </div>

                            <!-- 1200w Image -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">1200w Image (Tablet)</label>
                                @if (!string.IsNullOrEmpty(Model.CarouselImage1200wPath))
                                {
                                    <div class="current-image-container">
                                        <strong class="d-block mb-2">Current 1200w Image:</strong>
                                        <img src="~/img/@Model.CarouselImage1200wPath" alt="Current 1200w Image" />
                                        <div class="image-info mt-2">
                                            <i class="fas fa-check-circle text-success"></i> Currently using: @Model.CarouselImage1200wPath
                                        </div>
                                    </div>
                                }
                                <label class="form-label">Upload New 1200w Image (Optional)</label>
                                <input asp-for="CarouselImage1200w" type="file" class="form-control" accept="image/*" id="image1200w" />
                                <span asp-validation-for="CarouselImage1200w" class="text-danger"></span>
                                <small class="text-muted">Recommended for tablets and medium screens</small>
                                <div id="preview1200w" class="preview-container" style="display:none;">
                                    <span class="badge-new">NEW</span>
                                    <img id="img1200w" src="" alt="New Preview 1200w" />
                                    <div class="image-info" id="info1200w"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Translations -->
                        <div class="form-section">
                            <h4><i class="fas fa-language"></i> Translations</h4>
                            
                            <div class="row">
                                <!-- Turkish -->
                                <div class="col-md-6">
                                    <h5 class="text-danger"><i class="fas fa-flag"></i> Turkish (TR)</h5>
                                    <div class="mb-3">
                                        <label class="form-label">Title (Turkish)</label>
                                        <input asp-for="CarouselTitleTR" class="form-control" placeholder="Başlık" />
                                        <span asp-validation-for="CarouselTitleTR" class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Description (Turkish)</label>
                                        <textarea asp-for="CarouselDescriptionTR" class="form-control" rows="2" placeholder="Açıklama"></textarea>
                                        <span asp-validation-for="CarouselDescriptionTR" class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Button Text (Turkish)</label>
                                        <input asp-for="CarouselLinkTextTR" class="form-control" placeholder="Daha Fazla" />
                                        <span asp-validation-for="CarouselLinkTextTR" class="text-danger"></span>
                                    </div>
                                </div>

                                <!-- German -->
                                <div class="col-md-6">
                                    <h5 class="text-warning"><i class="fas fa-flag"></i> German (DE)</h5>
                                    <div class="mb-3">
                                        <label class="form-label">Title (German)</label>
                                        <input asp-for="CarouselTitleDE" class="form-control" placeholder="Titel" />
                                        <span asp-validation-for="CarouselTitleDE" class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Description (German)</label>
                                        <textarea asp-for="CarouselDescriptionDE" class="form-control" rows="2" placeholder="Beschreibung"></textarea>
                                        <span asp-validation-for="CarouselDescriptionDE" class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Button Text (German)</label>
                                        <input asp-for="CarouselLinkTextDE" class="form-control" placeholder="Mehr erfahren" />
                                        <span asp-validation-for="CarouselLinkTextDE" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex justify-content-between mt-4">
                            <a asp-controller="Admin" asp-action="Index" asp-route-scrollTo="SlideListManagement" 
                               class="btn btn-outline-secondary btn-lg px-4">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-warning btn-lg px-5 shadow text-dark" id="submitBtn">
                                <i class="fas fa-save"></i> Update Carousel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Image preview function
            function setupImagePreview(inputId, previewId, imgId, infoId) {
                $(`#${inputId}`).on('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            $(`#${previewId}`).show();
                            $(`#${imgId}`).attr('src', e.target.result);
                            
                            const img = new Image();
                            img.onload = function() {
                                const sizeKB = (file.size / 1024).toFixed(2);
                                $(`#${infoId}`).html(`
                                    <strong>File:</strong> ${file.name}<br>
                                    <strong>Size:</strong> ${sizeKB} KB<br>
                                    <strong>Dimensions:</strong> ${img.width} x ${img.height}px
                                `);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        $(`#${previewId}`).hide();
                    }
                });
            }

            // Setup previews for all images
            setupImagePreview('primaryImage', 'primaryPreview', 'primaryImg', 'primaryInfo');
            setupImagePreview('image600w', 'preview600w', 'img600w', 'info600w');
            setupImagePreview('image1200w', 'preview1200w', 'img1200w', 'info1200w');

            // Link preview
            $('input[name="CarouselLink"]').on('input', function() {
                const link = $(this).val().trim();
                if (link) {
                    $('#linkPreview').show();
                    $('#linkPreviewText').text(`Home/${link}`);
                } else {
                    $('#linkPreview').hide();
                }
            });

            // Form validation
            $('#carouselForm').on('submit', function(e) {
                $('#submitBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Updating...');
            });
        });
    </script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}