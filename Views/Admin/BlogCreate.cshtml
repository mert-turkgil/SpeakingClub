@model SpeakingClub.Models.BlogCreateModel

@{
    ViewData["Title"] = "Create Blog Post";
}

@section Css {
    <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/44.3.0/ckeditor5.css" />
    <link rel="stylesheet" href="~/lib/animate/animate.min.css">
    <link rel="stylesheet" href="~/lib/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="~/css/ck.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
        }
        .form-container {
            max-width: 1400px;
            padding: 35px;
            margin: 30px auto;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            background: #ffffff;
        }
        .page-header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 3px solid #0056b3;
        }
        .page-header h2 {
            color: #0056b3;
            font-weight: 600;
            font-size: 2rem;
        }
        .section-title {
            font-weight: 600;
            color: #0056b3;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-subtitle {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 400;
            margin-left: 10px;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .form-label small {
            font-weight: 400;
            color: #6c757d;
            font-size: 0.85rem;
        }
        .help-text {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 4px;
        }
        .char-counter {
            font-size: 0.8rem;
            color: #6c757d;
            float: right;
        }
        .char-counter.warning {
            color: #ffc107;
        }
        .char-counter.danger {
            color: #dc3545;
        }
        .form-control, .form-select {
            border-radius: 6px;
            border: 1px solid #ced4da;
            padding: 10px 15px;
        }
        .form-control:focus, .form-select:focus {
            border-color: #0056b3;
            box-shadow: 0 0 0 0.2rem rgba(0, 86, 179, 0.15);
        }
        .preview-img {
            max-width: 350px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
        }
        .nav-tabs .nav-link {
            color: #6c757d;
            font-weight: 500;
            border: none;
            border-bottom: 3px solid transparent;
            padding: 12px 24px;
        }
        .nav-tabs .nav-link:hover {
            border-bottom-color: #0056b3;
            color: #0056b3;
        }
        .nav-tabs .nav-link.active {
            color: #0056b3;
            background-color: transparent;
            border-bottom-color: #0056b3;
            font-weight: 600;
        }
        .preview-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
        }
        .preview-box h6 {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .btn {
            padding: 12px 30px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-success {
            background: #10b981;
            border: none;
        }
        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .btn-danger {
            background: #ef4444;
            border: none;
        }
        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .form-check-input:checked {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        /* Ensure visible white tick for checked checkboxes */
        .form-check-input[type="checkbox"]:checked {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='m6 10 3 3 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: center;
            background-size: 12px 12px;
            -webkit-appearance: auto;
            -moz-appearance: auto;
            appearance: auto;
        }
        /* Use accent-color for browsers that support it */
        .form-check-input {
            accent-color: #0056b3;
        }
        .seo-score {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .seo-score.good {
            background: #d1fae5;
            color: #065f46;
        }
        .seo-score.warning {
            background: #fef3c7;
            color: #92400e;
        }
        .seo-score.poor {
            background: #fee2e2;
            color: #991b1b;
        }
        .collapsible-section {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .collapsible-header {
            background: #f8f9fa;
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .collapsible-header:hover {
            background: #e9ecef;
        }
        .collapsible-header h5 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #0056b3;
        }
        .collapsible-content {
            padding: 20px;
            display: none;
        }
        .collapsible-content.show {
            display: block;
        }
        .toggle-icon {
            transition: transform 0.3s;
        }
        .toggle-icon.rotated {
            transform: rotate(180deg);
        }
        .badge-optional {
            background: #e9ecef;
            color: #6c757d;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 8px;
        }
        .slug-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px 15px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #495057;
        }
        .slug-preview strong {
            color: #0056b3;
        }
        .swiper-slide.card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .swiper-slide.card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
}

<div class="container animate__animated animate__fadeIn form-container">
    <div class="page-header">
        <h2><i class="fa-solid fa-pen-fancy"></i> Create Blog Post</h2>
        <p class="text-muted mb-0">Create engaging content with full SEO optimization and multilingual support</p>
    </div>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger animate__animated animate__shakeX">
            <i class="fa-solid fa-triangle-exclamation"></i> Please fix the errors below.
        </div>
    }

    <form asp-action="BlogCreate" method="post" enctype="multipart/form-data" id="blogForm">
        <div asp-validation-summary="ModelOnly" class="alert alert-warning"></div>

        <!-- =================================================================== -->
        <!-- BASIC INFORMATION -->
        <!-- =================================================================== -->
        <h4 class="section-title">
            <i class="fa-solid fa-pen"></i> Basic Information
        </h4>

        <!-- Blog Title -->
        <div class="mb-4">
            <label asp-for="Title" class="form-label">
                Blog Title <small>(Required - Max 200 characters)</small>
                <span class="char-counter" id="titleCounter">0 / 200</span>
            </label>
            <input asp-for="Title" class="form-control" placeholder="Enter an engaging and descriptive title..." 
                   id="titleInput" maxlength="200" />
            <span asp-validation-for="Title" class="text-danger"></span>
            <div class="help-text">
                <i class="fa-solid fa-lightbulb"></i> Tip: Use 50-60 characters for optimal SEO
            </div>
        </div>

        <!-- Short Description -->
        <div class="mb-4">
            <label asp-for="Description" class="form-label">
                Short Description <small>(Max 250 characters)</small>
                <span class="char-counter" id="descCounter">0 / 250</span>
            </label>
            <textarea asp-for="Description" class="form-control" rows="3" 
                      placeholder="Brief description of your blog post..." 
                      id="descInput" maxlength="250"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
            <div class="help-text">
                <i class="fa-solid fa-lightbulb"></i> This will be used as the default meta description
            </div>
        </div>

        <!-- Main Blog Content -->
        <div class="mb-4">
            <label asp-for="Content" class="form-label">Main Content (English)</label>
            <textarea asp-for="Content" id="Content" class="form-control">@(Model.Content ?? "")</textarea>
            <span asp-validation-for="Content" class="text-danger"></span>
        </div>

        <!-- Cover Image -->
        <div class="mb-4">
            <label asp-for="ImageFile" class="form-label">
                Cover Image <small>(Recommended: 1200x630px for social sharing)</small>
            </label>
            <input asp-for="ImageFile" type="file" class="form-control" accept="image/*" 
                   id="ImageFile" onchange="previewImage(event)" />
            <img id="coverPreview" class="preview-img mt-3" style="display: none;" alt="Cover preview" />
            <div class="help-text">
                <i class="fa-solid fa-lightbulb"></i> Will be used for Open Graph and social media sharing
            </div>
        </div>

        <!-- Author & Date -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <label asp-for="Author" class="form-label">Author <small>(Required)</small></label>
                <input asp-for="Author" class="form-control" placeholder="Author name" />
                <span asp-validation-for="Author" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-4">
                <label asp-for="Date" class="form-label">Publish Date</label>
                <input asp-for="Date" type="datetime-local" class="form-control" />
            </div>
        </div>

        <!-- Publishing Options -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="form-check">
                    <input asp-for="IsPublished" class="form-check-input" type="checkbox" id="isPublishedCheck" />
                    <label asp-for="IsPublished" class="form-check-label" for="isPublishedCheck">
                        <i class="fa-solid fa-eye"></i> Publish Immediately
                    </label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check">
                    <input asp-for="IsHome" class="form-check-input" type="checkbox" id="isHomeCheck" />
                    <label asp-for="IsHome" class="form-check-label" for="isHomeCheck">
                        <i class="fa-solid fa-house"></i> Display on Home Page
                    </label>
                </div>
            </div>
        </div>

        <!-- =================================================================== -->
        <!-- SEO OPTIMIZATION -->
        <!-- =================================================================== -->
        <h4 class="section-title">
            <i class="fa-solid fa-magnifying-glass-chart"></i> SEO Optimization
            <span class="badge-optional">IMPORTANT</span>
        </h4>

        <!-- SEO Score Display -->
        <div class="alert alert-info mb-4">
            <strong><i class="fa-solid fa-chart-line"></i> SEO Score:</strong>
            <span class="seo-score poor" id="seoScore">Not Analyzed</span>
            <div class="mt-2" id="seoTips"></div>
        </div>

        <!-- URL Slug -->
        <div class="mb-4">
            <label asp-for="Slug" class="form-label">
                URL Slug <small>(Auto-generated from title if left empty)</small>
            </label>
            <input asp-for="Slug" class="form-control" placeholder="my-blog-post-url" 
                   id="slugInput" pattern="[a-z0-9\-]*" />
            <span asp-validation-for="Slug" class="text-danger"></span>
            <div class="slug-preview" id="slugPreview">
                <i class="fa-solid fa-link"></i> Preview: <strong>https://almanca-konus.com/blog/your-slug-here</strong>
            </div>
            <div class="help-text">
                <i class="fa-solid fa-lightbulb"></i> Use lowercase, hyphens only. Will be auto-generated from title if empty.
            </div>
        </div>

        <!-- Meta Description -->
        <div class="mb-4">
            <label asp-for="MetaDescription" class="form-label">
                Meta Description <small>(150-160 characters recommended)</small>
                <span class="char-counter" id="metaDescCounter">0 / 160</span>
            </label>
            <textarea asp-for="MetaDescription" class="form-control" rows="3" 
                      placeholder="Compelling description for search results..." 
                      id="metaDescInput" maxlength="160"></textarea>
            <span asp-validation-for="MetaDescription" class="text-danger"></span>
            <div class="help-text">
                <i class="fa-solid fa-lightbulb"></i> This appears in Google search results. Make it compelling!
            </div>
        </div>

        <!-- Meta Keywords & Focus Keyphrase -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <label asp-for="MetaKeywords" class="form-label">
                    Meta Keywords <small>(5-10 keywords, comma-separated)</small>
                </label>
                <input asp-for="MetaKeywords" class="form-control" 
                       placeholder="german language, learn german, speaking club" />
                <span asp-validation-for="MetaKeywords" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-4">
                <label asp-for="FocusKeyphrase" class="form-label">
                    Focus Keyphrase <small>(Main SEO target)</small>
                </label>
                <input asp-for="FocusKeyphrase" class="form-control" 
                       placeholder="learn german online" id="focusInput" />
                <div class="help-text">
                    <i class="fa-solid fa-bullseye"></i> Target this phrase in title, URL, and content
                </div>
            </div>
        </div>

        <!-- Advanced SEO Options (Collapsible) -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection('advancedSeo')">
                <h5><i class="fa-solid fa-sliders"></i> Advanced SEO Settings</h5>
                <i class="fa-solid fa-chevron-down toggle-icon" id="advancedSeoIcon"></i>
            </div>
            <div class="collapsible-content" id="advancedSeoContent">
                <div class="mb-3">
                    <label asp-for="MetaTitle" class="form-label">
                        Meta Title <small>(Override default title for SEO)</small>
                    </label>
                    <input asp-for="MetaTitle" class="form-control" placeholder="Custom SEO title" />
                    <div class="help-text">Leave empty to use the blog title</div>
                </div>

                <div class="mb-3">
                    <label asp-for="CanonicalUrl" class="form-label">
                        Canonical URL <small>(Prevent duplicate content)</small>
                    </label>
                    <input asp-for="CanonicalUrl" class="form-control" 
                           placeholder="https://almanca-konus.com/blog/your-post" />
                    <div class="help-text">Auto-generated if left empty</div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check mb-3">
                            <input asp-for="NoIndex" class="form-check-input" type="checkbox" id="noIndexCheck" />
                            <label asp-for="NoIndex" class="form-check-label" for="noIndexCheck">
                                <strong>No Index</strong> - Hide from search engines
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check mb-3">
                            <input asp-for="NoFollow" class="form-check-input" type="checkbox" id="noFollowCheck" />
                            <label asp-for="NoFollow" class="form-check-label" for="noFollowCheck">
                                <strong>No Follow</strong> - Don't follow links
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- =================================================================== -->
        <!-- SOCIAL MEDIA OPTIMIZATION -->
        <!-- =================================================================== -->
        <h4 class="section-title">
            <i class="fa-brands fa-facebook"></i> Social Media (Open Graph)
            <span class="badge-optional">Optional</span>
        </h4>

        <div class="alert alert-light mb-4">
            <i class="fa-solid fa-info-circle"></i> These settings control how your post appears when shared on social media
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <label asp-for="OgTitle" class="form-label">Social Title</label>
                <input asp-for="OgTitle" class="form-control" placeholder="Title for social sharing" />
                <div class="help-text">Leave empty to use blog title</div>
            </div>
            <div class="col-md-6 mb-4">
                <label asp-for="OgDescription" class="form-label">Social Description</label>
                <input asp-for="OgDescription" class="form-control" placeholder="Description for social sharing" />
                <div class="help-text">Leave empty to use meta description</div>
            </div>
        </div>

        <!-- =================================================================== -->
        <!-- CATEGORIES & TAGS -->
        <!-- =================================================================== -->
        <h4 class="section-title">
            <i class="fa-solid fa-folder-tree"></i> Organization
        </h4>

        <!-- Categories -->
        <div class="mb-4">
            <label class="form-label"><i class="fa-solid fa-folder"></i> Category</label>
            <div class="swiper categorySwiper">
                <div class="swiper-wrapper">
                    @foreach (var category in (IEnumerable<SelectListItem>)ViewBag.Categories)
                    {
                        <div class="swiper-slide card p-3">
                            <input type="checkbox" name="SelectedCategoryIds" value="@category.Value" 
                                   class="form-check-input me-2" id="cat-@category.Value" />
                            <label class="form-check-label" for="cat-@category.Value">@category.Text</label>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Tags -->
        <div class="mb-4">
            <label class="form-label"><i class="fa-solid fa-tags"></i> Tags</label>
            <div>
                @foreach (var tag in (IEnumerable<SelectListItem>)ViewBag.Tags)
                {
                    <div class="form-check form-check-inline">
                        <input type="checkbox" name="SelectedTagIds" value="@tag.Value" 
                               class="form-check-input" id="tag-@tag.Value" />
                        <label class="form-check-label" for="tag-@tag.Value">@tag.Text</label>
                    </div>
                }
            </div>
        </div>

        <!-- =================================================================== -->
        <!-- OPTIONAL FEATURES -->
        <!-- =================================================================== -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection('optionalFeatures')">
                <h5><i class="fa-solid fa-puzzle-piece"></i> Optional Features</h5>
                <i class="fa-solid fa-chevron-down toggle-icon" id="optionalFeaturesIcon"></i>
            </div>
            <div class="collapsible-content" id="optionalFeaturesContent">
                <!-- Embed YouTube & Maps -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label asp-for="RawYT" class="form-label">
                            <i class="fa-brands fa-youtube"></i> YouTube Embed Code
                        </label>
                        <textarea asp-for="RawYT" class="form-control" rows="3" 
                                  placeholder="<iframe ...>"></textarea>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="RawMaps" class="form-label">
                            <i class="fa-solid fa-map-location-dot"></i> Google Maps Embed Code
                        </label>
                        <textarea asp-for="RawMaps" class="form-control" rows="3" 
                                  placeholder="<iframe ...>"></textarea>
                    </div>
                </div>

                <!-- Quiz Selection -->
                <h6 class="mt-4 mb-3"><i class="fa-solid fa-question-circle"></i> Quiz Association</h6>
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Select a Quiz</label>
                        <select id="quizDropdown" class="form-select">
                            <option value="">-- Select a Quiz --</option>
                            @foreach (var quiz in (IEnumerable<SelectListItem>)ViewBag.Quizzes)
                            {
                                <option value="@quiz.Value">@quiz.Text</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Select Quiz Question</label>
                        <select asp-for="SelectedQuestionId" class="form-select" id="quizQuestionsDropdown">
                            <option value="">-- Select a Question --</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- =================================================================== -->
        <!-- TRANSLATIONS -->
        <!-- =================================================================== -->
        <h4 class="section-title">
            <i class="fa-solid fa-language"></i> Translations
            <span class="badge-optional">Optional but Recommended</span>
        </h4>

        <div class="alert alert-warning mb-4">
            <i class="fa-solid fa-exclamation-triangle"></i> <strong>Important:</strong> 
            Each translation should be properly localized, not just machine-translated. 
            Consider cultural context and local keywords.
        </div>

        <ul class="nav nav-tabs mb-3" role="tablist">
            <li class="nav-item" role="presentation">
                <button type="button" class="nav-link active" data-bs-toggle="tab" 
                        data-bs-target="#tr" role="tab" aria-selected="true">
                    <i class="fa-solid fa-flag"></i> Turkish (Türkçe)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button type="button" class="nav-link" data-bs-toggle="tab" 
                        data-bs-target="#de" role="tab" aria-selected="false">
                    <i class="fa-solid fa-flag"></i> German (Deutsch)
                </button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- Turkish Translation -->
            <div class="tab-pane fade show active" id="tr" role="tabpanel">
                <div class="mb-3">
                    <label asp-for="TitleTR" class="form-label">Turkish Title</label>
                    <input asp-for="TitleTR" placeholder="Türkçe başlık" class="form-control" 
                           id="titleTRInput" maxlength="200" />
                    <span class="char-counter" id="titleTRCounter">0 / 200</span>
                </div>
                
                <div class="mb-3">
                    <label asp-for="DescriptionTR" class="form-label">Turkish Description</label>
                    <textarea asp-for="DescriptionTR" class="form-control" rows="2" 
                              placeholder="Kısa açıklama" maxlength="250"></textarea>
                </div>

                <div class="mb-3">
                    <label asp-for="ContentTR" class="form-label">Turkish Content</label>
                    <textarea asp-for="ContentTR" id="ContentTR" class="form-control"></textarea>
                </div>

                <!-- Turkish SEO Fields (Collapsible) -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection('turkishSeo')">
                        <h6><i class="fa-solid fa-magnifying-glass"></i> Turkish SEO Settings</h6>
                        <i class="fa-solid fa-chevron-down toggle-icon" id="turkishSeoIcon"></i>
                    </div>
                    <div class="collapsible-content" id="turkishSeoContent">
                        <div class="mb-3">
                            <label asp-for="SlugTR" class="form-label">Turkish Slug</label>
                            <input asp-for="SlugTR" class="form-control" placeholder="turkce-url" />
                        </div>
                        <div class="mb-3">
                            <label asp-for="MetaDescriptionTR" class="form-label">Turkish Meta Description</label>
                            <textarea asp-for="MetaDescriptionTR" class="form-control" rows="2" 
                                      maxlength="160"></textarea>
                        </div>
                        <div class="mb-3">
                            <label asp-for="MetaKeywordsTR" class="form-label">Turkish Keywords</label>
                            <input asp-for="MetaKeywordsTR" class="form-control" 
                                   placeholder="almanca öğren, konuşma kulübü" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- German Translation -->
            <div class="tab-pane fade" id="de" role="tabpanel">
                <div class="mb-3">
                    <label asp-for="TitleDE" class="form-label">German Title</label>
                    <input asp-for="TitleDE" placeholder="Deutscher Titel" class="form-control" 
                           maxlength="200" />
                </div>
                
                <div class="mb-3">
                    <label asp-for="DescriptionDE" class="form-label">German Description</label>
                    <textarea asp-for="DescriptionDE" class="form-control" rows="2" 
                              placeholder="Kurze Beschreibung" maxlength="250"></textarea>
                </div>

                <div class="mb-3">
                    <label asp-for="ContentDE" class="form-label">German Content</label>
                    <textarea asp-for="ContentDE" id="ContentDE" class="form-control"></textarea>
                </div>

                <!-- German SEO Fields (Collapsible) -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection('germanSeo')">
                        <h6><i class="fa-solid fa-magnifying-glass"></i> German SEO Settings</h6>
                        <i class="fa-solid fa-chevron-down toggle-icon" id="germanSeoIcon"></i>
                    </div>
                    <div class="collapsible-content" id="germanSeoContent">
                        <div class="mb-3">
                            <label asp-for="SlugDE" class="form-label">German Slug</label>
                            <input asp-for="SlugDE" class="form-control" placeholder="deutscher-url" />
                        </div>
                        <div class="mb-3">
                            <label asp-for="MetaDescriptionDE" class="form-label">German Meta Description</label>
                            <textarea asp-for="MetaDescriptionDE" class="form-control" rows="2" 
                                      maxlength="160"></textarea>
                        </div>
                        <div class="mb-3">
                            <label asp-for="MetaKeywordsDE" class="form-label">German Keywords</label>
                            <input asp-for="MetaKeywordsDE" class="form-control" 
                                   placeholder="deutsch lernen, sprachclub" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- =================================================================== -->
        <!-- SUBMIT BUTTONS -->
        <!-- =================================================================== -->
        <div class="d-flex justify-content-between mt-5 pt-4 border-top">
            <button type="submit" class="btn btn-success px-5">
                <i class="fa-solid fa-check"></i> Publish Blog Post
            </button>
            <a asp-controller="Admin" asp-route-scrollTo="BlogManagement" asp-action="Index" 
               class="btn btn-danger px-5">
                <i class="fa-solid fa-xmark"></i> Cancel
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdn.ckeditor.com/ckeditor5/44.3.0/ckeditor5.umd.js"></script>
    <script src="https://cdn.ckbox.io/ckbox/2.6.1/ckbox.js"></script>
    <script src="~/js/ckeditor.js"></script>

    <script>
        $(document).ready(function() {
            // ===================================
            // Character Counters
            // ===================================
            function updateCounter(inputId, counterId, maxLength) {
                const input = $('#' + inputId);
                const counter = $('#' + counterId);
                
                function update() {
                    const length = input.val().length;
                    counter.text(length + ' / ' + maxLength);
                    
                    // Color coding
                    counter.removeClass('warning danger');
                    if (length > maxLength * 0.9) {
                        counter.addClass('danger');
                    } else if (length > maxLength * 0.75) {
                        counter.addClass('warning');
                    }
                }
                
                input.on('input', update);
                update();
            }
            
            updateCounter('titleInput', 'titleCounter', 200);
            updateCounter('descInput', 'descCounter', 250);
            updateCounter('metaDescInput', 'metaDescCounter', 160);
            updateCounter('titleTRInput', 'titleTRCounter', 200);

            // ===================================
            // Slug Auto-Generation & Preview
            // ===================================
            function generateSlug(text) {
                return text.toLowerCase()
                    .replace(/ç/g, 'c')
                    .replace(/ğ/g, 'g')
                    .replace(/ı/g, 'i')
                    .replace(/ö/g, 'o')
                    .replace(/ş/g, 's')
                    .replace(/ü/g, 'u')
                    .replace(/[^a-z0-9\s\-]/g, '')
                    .replace(/\s+/g, '-')
                    .replace(/\-+/g, '-')
                    .replace(/^\-+|\-+$/g, '')
                    .substring(0, 100);
            }

            $('#titleInput').on('input', function() {
                if ($('#slugInput').val() === '') {
                    const slug = generateSlug($(this).val());
                    $('#slugPreview strong').text('https://almanca-konus.com/blog/' + (slug || 'your-slug-here'));
                }
            });

            $('#slugInput').on('input', function() {
                const slug = $(this).val() || 'your-slug-here';
                $('#slugPreview strong').text('https://almanca-konus.com/blog/' + slug);
            });

            // ===================================
            // SEO Score Calculator
            // ===================================
            function calculateSEOScore() {
                let score = 0;
                let tips = [];
                
                // Title check (15 points)
                const title = $('#titleInput').val();
                if (title.length >= 50 && title.length <= 60) {
                    score += 15;
                } else if (title.length > 0) {
                    score += 8;
                    tips.push('✓ Title should be 50-60 characters');
                }
                
                // Description check (15 points)
                const desc = $('#descInput').val();
                if (desc.length >= 140 && desc.length <= 160) {
                    score += 15;
                } else if (desc.length > 0) {
                    score += 8;
                    tips.push('✓ Description should be 140-160 characters');
                }
                
                // Meta description check (15 points)
                const metaDesc = $('#metaDescInput').val();
                if (metaDesc.length >= 150 && metaDesc.length <= 160) {
                    score += 15;
                } else if (metaDesc.length > 0) {
                    score += 8;
                    tips.push('✓ Meta description should be 150-160 characters');
                } else {
                    tips.push('✗ Add a meta description');
                }
                
                // Slug check (10 points)
                const slug = $('#slugInput').val();
                if (slug.length > 0 && slug.length <= 50) {
                    score += 10;
                } else if (slug.length === 0) {
                    score += 5; // Will be auto-generated
                }
                
                // Keywords check (10 points)
                const keywords = $('#focusInput').val();
                if (keywords.length > 0) {
                    score += 10;
                } else {
                    tips.push('✗ Add a focus keyphrase');
                }
                
                // Image check (15 points)
                if ($('#ImageFile').val()) {
                    score += 15;
                } else {
                    tips.push('✗ Add a cover image for social sharing');
                }
                
                // Content check (20 points) - check if CKEditor has content
                // This is simplified; you'd need to check actual editor content
                score += 10; // Partial score for having the editor
                
                // Update score display
                const scoreElem = $('#seoScore');
                const tipsElem = $('#seoTips');
                
                scoreElem.text(score + ' / 100');
                scoreElem.removeClass('poor warning good');
                
                if (score >= 80) {
                    scoreElem.addClass('good');
                } else if (score >= 60) {
                    scoreElem.addClass('warning');
                } else {
                    scoreElem.addClass('poor');
                }
                
                if (tips.length > 0) {
                    tipsElem.html('<small>' + tips.join('<br>') + '</small>');
                } else {
                    tipsElem.html('<small>✓ Great! Your SEO looks good.</small>');
                }
            }

            // Recalculate on key inputs
            $('#titleInput, #descInput, #metaDescInput, #focusInput, #slugInput').on('input', function() {
                calculateSEOScore();
            });
            
            $('#ImageFile').on('change', function() {
                calculateSEOScore();
            });

            // Initial calculation
            calculateSEOScore();

            // ===================================
            // Cover Image Preview
            // ===================================
            window.previewImage = function(event) {
                const preview = $('#coverPreview');
                const file = event.target.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.attr('src', e.target.result).show();
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.hide();
                }
            };

            // ===================================
            // Quiz Dropdown Handler
            // ===================================
            $('#quizDropdown').on('change', function () {
                var selectedQuizId = $(this).val();
                var dropdown = $('#quizQuestionsDropdown');
                dropdown.empty();
                dropdown.append($('<option>').val("").text("-- Select a Question --"));
                
                if (selectedQuizId) {
                    $.ajax({
                        url: '@Url.Action("GetQuizQuestions", "Admin")',
                        type: 'GET',
                        data: { quizId: selectedQuizId },
                        success: function (data) {
                            $.each(data, function (index, question) {
                                dropdown.append($('<option>').val(question.questionId).text(question.questionText));
                            });
                        },
                        error: function (xhr, status, error) {
                            console.error("Error fetching quiz questions: " + error);
                        }
                    });
                }
            });

            // ===================================
            // Collapsible Sections
            // ===================================
            window.toggleSection = function(sectionId) {
                const content = $('#' + sectionId + 'Content');
                const icon = $('#' + sectionId + 'Icon');
                
                content.toggleClass('show');
                icon.toggleClass('rotated');
            };

            // ===================================
            // Form Validation Enhancements
            // ===================================
            $('#blogForm').on('submit', function(e) {
                let isValid = true;
                let errors = [];

                // Title is required
                if ($('#titleInput').val().trim() === '') {
                    errors.push('Blog title is required');
                    isValid = false;
                }

                // Author is required  
                if ($('input[name="Author"]').val().trim() === '') {
                    errors.push('Author name is required');
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();
                    alert('Please fix the following errors:\n\n' + errors.join('\n'));
                    return false;
                }
            });

            // ===================================
            // Initialize Swiper for Categories
            // ===================================
            new Swiper('.categorySwiper', {
                slidesPerView: 'auto',
                spaceBetween: 15,
                freeMode: true,
                breakpoints: {
                    640: { slidesPerView: 2 },
                    768: { slidesPerView: 3 },
                    1024: { slidesPerView: 4 }
                }
            });
        });
    </script>
}
